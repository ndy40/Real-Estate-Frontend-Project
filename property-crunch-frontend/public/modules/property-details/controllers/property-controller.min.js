define(["../module.min"],function(r){"use strict";r.controller("PropertyCtrl",["$scope","$rootScope","UserModel","SearchService","$routeParams","$location","emailService","propertyService","$cookieStore",function(r,e,t,o,a,s,i,p,n){r.property={details:{},status:!1,errorStatus:!1,statusMsg:"Loading Details.. Please Wait",errorMsg:"",avgPrice:{data:"",status:!1,statusMsg:"Loading Market Difference..",errorStatus:!1,errorMsg:""},priceHistory:{data:"",diff:"",status:!1,statusMsg:"Loading Price Changes..",errorStatus:!1,errorMsg:""},comparables:{list:{},title:"",status:!1,statusMsg:"Loading Comparables. Please Wait..",errorStatus:!1,errorMsg:""}},r.pageTour={noTour:n.get("noTour")},r.startTour=function(){r.pageTour.noTour||r.$broadcast("runTour")},r.setPageRoute=function(){r.propertyId=a.id},r.getPropertyDetails=function(){p.getProperty(a.id).success(r.loadPropertyDetails).error(function(e){r.property.errorStatus=!0,r.property.errorMsg="Unable to load data: "+e.message,r.property.status=!1})},r.loadPropertyDetails=function(e){r.property.details=e,r.getAvgPrice(e.post_code_id,e.rooms,e.type_id),r.getPriceHistroy(e.id),r.property.comparables.title=e.rooms+" Bedroom "+e.type+" for Sale",r.getComparables(e.id),r.populateRqstDetailsData(e),r.populateEmailFriendData(e),r.property.errorStatus=!1,r.property.status=!0,r.startTour()},r.getAvgPrice=function(e,t,o){p.getAvgPrice(e,t,o).success(function(e){r.property.avgPrice.data=e.data,r.property.avgPrice.errorStatus=!1,r.property.avgPrice.status=!0}).error(function(){r.property.avgPrice.errorStatus=!0,r.property.avgPrice.errorMsg="Unable to get market data",r.property.avgPrice.status=!1})},r.getPriceHistroy=function(e){p.getPriceHistroy(e).success(function(e){e.data.hasOwnProperty("data")?(r.property.priceHistory.data=e.data,r.property.priceHistory.errorStatus=!1,r.property.priceHistory.status=!0):(r.property.priceHistory.errorStatus=!0,r.property.priceHistory.errorMsg="No price history",r.property.priceHistory.status=!1)}).error(function(){r.property.priceHistory.errorStatus=!0,r.property.priceHistory.errorMsg="Unable to get historical data",r.property.priceHistory.status=!1})},r.getComparables=function(e){p.getComparables(e).success(function(e){r.property.comparables.list=e,r.property.comparables.errorStatus=!1,r.property.comparables.status=!0}).error(function(){r.property.comparables.errorStatus=!0,r.property.comparables.errorMsg="Unable to get comparables",r.property.comparables.status=!1})},r.email={toFriend:{name:"",email:"",friendsEmail:"",msg:"I thought you might want to take a look at this property for sale on thenello.com",propertyTitle:"",propertyImg:"",propertyPrice:""},requestDetails:{name:"",email:"",phone:"",msg:"",agencyName:"",agencyPhone:"",propertyId:""}},r.populateRqstDetailsData=function(e){r.email.requestDetails.agencyName=e.marketer,r.email.requestDetails.agencyPhone=e.phone,r.email.requestDetails.propertyId=e.id,r.email.requestDetails.msg="Hi, I found your listing on thenello.com. Please send me more information about "+e.address+". Thank you."},r.populateEmailFriendData=function(e){r.email.toFriend.propertyTitle=e.rooms+" bed property for Sale at "+e.address,r.email.toFriend.propertyImg=e.images[0].image,r.email.toFriend.propertyPrice=e.price},r.emailRequestDetails=function(){i.updateRequestDetails(r.email.requestDetails)},r.emailFriend=function(){i.updateToFriend(r.email.toFriend)},r.addToFavourites=function(r){null!==t.userId?t.addToFav(r).success(function(){t.addToFavFE(r),e.$broadcast("favUpdated")}):s.path("/sign/in")},r.$on("favUpdated",function(){r.favUpdate=r.favUpdate?!1:!0}),r.init=function(){r.getPropertyDetails(),r.setPageRoute()},r.init()}])});