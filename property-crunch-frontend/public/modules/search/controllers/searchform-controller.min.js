define(["../module.min"],function(e){"use strict";e.controller("SearchFormCtrl",["$scope","$rootScope","UserModel","SearchService","$location",function(e,t,a,r,c){e.searchObject={properties:[],count:"",status:!1,busy:!0,last:!1,advSearchStatus:!1,errorType:{location:!1,filters:!1}},e.getProperties=function(){r.results.hasOwnProperty("data")?(e.searchObject.keywords=r.getKeywords(),e.loadPropertyTable(r.getCache())):(r.setKeyword(e.searchObject.keywords),r.getResults().success(e.loadPropertyTable))},e.loadPropertyTable=function(t){t.hasOwnProperty("data")&&t.data.length>0?(e.searchObject.status=!0,e.searchObject.properties=t.data,e.searchObject.count=t.count,e.searchObject.busy=!1,e.searchObject.errorType.location=!1,e.searchObject.errorType.filters=!1,r.cacheResults(t)):(r.clearCache(),e.searchObject.status=!1,void 0!==e.searchObject.keywords&&r.testLocation().success(function(t){t.hasOwnProperty("data")&&t.data.length>0?(e.searchObject.errorType.location=!1,e.searchObject.errorType.filters=!0):e.searchObject.errorType.location=!0}))},e.getProperties(),e.updateFilters=function(){r.clearCache(),r.setCurrentPage(1),e.getProperties()},e.advanceSearch=function(){e.searchObject.busy=!0,e.searchObject.advSearchStatus=!0},e.closeAdvancedSearch=function(){e.getProperties(),e.searchObject.busy=!1,e.searchObject.advSearchStatus=!1},e.infiniteLoader=function(){e.searchObject.busy||(e.searchObject.busy=!0,e.searchObject.last||(r.setCurrentPage(r.getCurrentPage()+1),r.getResults().success(function(t){t.data.length>0?(e.searchObject.properties=e.searchObject.properties.concat(t.data),e.searchObject.busy=!1):(e.searchObject.busy=!1,e.searchObject.last=!0)}.bind(this))))},e.addToFavourites=function(e){a.isLoggedIn?a.addToFav(e).success(function(){a.addToFavFE(e),t.$broadcast("favUpdated")}):c.path("/sign/in")},e.$on("favUpdated",function(){e.favUpdate=e.favUpdate?!1:!0})}])});